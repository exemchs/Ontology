---
phase: 02-layout-shell
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/auth.ts
  - src/lib/navigation.ts
  - src/hooks/use-auth.ts
  - src/app/login/page.tsx
  - src/components/layout/login-graph.tsx
  - src/app/(authenticated)/layout.tsx
  - src/app/(authenticated)/page.tsx
  - src/app/(authenticated)/monitoring/dgraph/page.tsx
  - src/app/(authenticated)/monitoring/gpu/page.tsx
  - src/app/(authenticated)/workspace/studio/page.tsx
  - src/app/(authenticated)/workspace/query/page.tsx
  - src/app/(authenticated)/admin/users/page.tsx
  - src/app/page.tsx
autonomous: true
requirements:
  - AUTH-01
  - AUTH-06

must_haves:
  truths:
    - "비밀번호 입력 없이는 어떤 페이지에도 접근할 수 없다"
    - "올바른 비밀번호 입력 후 대시보드(/)로 리다이렉트된다"
    - "잘못된 비밀번호 입력 시 빨간 인라인 에러 텍스트가 표시된다"
    - "이미 인증된 상태에서 /login 접근 시 /로 리다이렉트된다"
    - "6개 URL 경로가 모두 존재하고 각각 스텁 페이지를 렌더한다"
    - "로그인 페이지에서 좌/우 분할 레이아웃이 보인다 (폼 왼쪽, D3 그래프 오른쪽)"
  artifacts:
    - path: "src/lib/auth.ts"
      provides: "Password validation logic, AUTH_KEY constant, CORRECT_PASSWORD default"
      exports: ["AUTH_KEY", "WELCOME_KEY", "validatePassword"]
    - path: "src/lib/navigation.ts"
      provides: "Route definitions, sidebar nav groups, breadcrumb mapping"
      exports: ["NavItem", "NavGroup", "navigationGroups", "breadcrumbMap"]
    - path: "src/hooks/use-auth.ts"
      provides: "Auth state management hook with login/logout/isAuthenticated"
      exports: ["useAuth"]
    - path: "src/app/login/page.tsx"
      provides: "Password Gate page with split layout"
      min_lines: 50
    - path: "src/components/layout/login-graph.tsx"
      provides: "Decorative D3 force graph for login right panel"
      min_lines: 60
    - path: "src/app/(authenticated)/layout.tsx"
      provides: "Auth-guarded layout wrapper (placeholder for sidebar+header)"
      min_lines: 20
    - path: "src/app/(authenticated)/page.tsx"
      provides: "Dashboard stub page at /"
    - path: "src/app/(authenticated)/monitoring/dgraph/page.tsx"
      provides: "DGraph stub at /monitoring/dgraph"
    - path: "src/app/(authenticated)/monitoring/gpu/page.tsx"
      provides: "GPU stub at /monitoring/gpu"
    - path: "src/app/(authenticated)/workspace/studio/page.tsx"
      provides: "Studio stub at /workspace/studio"
    - path: "src/app/(authenticated)/workspace/query/page.tsx"
      provides: "Query stub at /workspace/query"
    - path: "src/app/(authenticated)/admin/users/page.tsx"
      provides: "Users stub at /admin/users"
  key_links:
    - from: "src/hooks/use-auth.ts"
      to: "src/lib/auth.ts"
      via: "import validatePassword, AUTH_KEY, WELCOME_KEY"
      pattern: "import.*from.*@/lib/auth"
    - from: "src/app/login/page.tsx"
      to: "src/hooks/use-auth.ts"
      via: "useAuth hook for login()"
      pattern: "useAuth\\(\\)"
    - from: "src/app/(authenticated)/layout.tsx"
      to: "src/hooks/use-auth.ts"
      via: "useAuth hook for isAuthenticated check + redirect"
      pattern: "useAuth\\(\\)"
    - from: "src/components/layout/login-graph.tsx"
      to: "d3"
      via: "D3 force simulation for decorative ontology graph"
      pattern: "d3\\.forceSimulation"
---

<objective>
Auth infrastructure, Password Gate with D3 decorative graph, routing skeleton with 6 page stubs

Purpose: Establish the auth gate that blocks unauthenticated access and create the complete route structure. After this plan, users must enter a password to see any page, and all 6 routes exist as stubs within an authenticated route group.

Output: lib/auth.ts, lib/navigation.ts, hooks/use-auth.ts, login page with D3 graph, (authenticated) layout with auth guard, 6 page stubs
</objective>

<execution_context>
@/Users/chs/.claude/get-shit-done/workflows/execute-plan.md
@/Users/chs/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-layout-shell/02-CONTEXT.md
@.planning/phases/02-layout-shell/02-RESEARCH.md
@src/app/layout.tsx
@src/app/globals.css
@src/types/index.ts
@src/data/studio-data.ts
@src/components/theme-provider.tsx
@src/lib/utils.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Auth logic, navigation config, and auth hook</name>
  <files>src/lib/auth.ts, src/lib/navigation.ts, src/hooks/use-auth.ts</files>
  <action>
Create three foundation files that all layout components will consume.

**src/lib/auth.ts:**
- Export `AUTH_KEY = "exemble-auth"` (sessionStorage key)
- Export `WELCOME_KEY = "exemble-welcome-dismissed"` (sessionStorage key for welcome popup)
- Export `validatePassword(password: string): boolean` that checks against `process.env.NEXT_PUBLIC_SITE_PASSWORD ?? "exem123"`. Per user decision: POC password-only, sessionStorage-based session.

**src/lib/navigation.ts:**
- Export `NavItem` interface: `{ title: string; url: string; icon: React.ComponentType<{ className?: string }>; description?: string }`
- Export `NavGroup` interface: `{ label: string; items: NavItem[] }`
- Export `navigationGroups: NavGroup[]` with 4 groups using lucide-react icons:
  - Operations: Overview (LayoutDashboard, `/`), GPU Monitoring (Cpu, `/monitoring/gpu`)
  - Monitoring: Graph Cluster (Network, `/monitoring/dgraph`)
  - Workspace: Ontology Studio (Workflow, `/workspace/studio`), Query Console (Terminal, `/workspace/query`)
  - Administration: User Management (Users, `/admin/users`)
- Export `breadcrumbMap: Record<string, { group: string; page: string }>` mapping each of the 6 routes to their group+page labels. Used by header breadcrumbs.
- Export `allNavItems` helper: flat array of all nav items (used by command palette for search).
- This is the SINGLE source of truth for routes. Sidebar, command palette, and breadcrumbs all consume this.

**src/hooks/use-auth.ts:**
- `"use client"` directive
- Import `AUTH_KEY`, `WELCOME_KEY`, `validatePassword` from `@/lib/auth`
- `useAuth()` returns `{ isAuthenticated: boolean | null, login: (password: string) => boolean, logout: () => void }`
- `isAuthenticated` starts as `null` (loading/SSR), set in `useEffect` from `sessionStorage.getItem(AUTH_KEY)`
- `login()` validates with `validatePassword()`, sets `sessionStorage.setItem(AUTH_KEY, "true")`, returns success boolean
- `logout()` removes both `AUTH_KEY` and `WELCOME_KEY` from sessionStorage (per user decision: welcome reappears after logout), sets `isAuthenticated` to `false`, calls `router.push("/login")`
- Guard all `sessionStorage` access inside useEffect to avoid SSR errors (Pitfall 1 from research)
  </action>
  <verify>
Run `npx tsc --noEmit` to confirm no type errors. Check that auth.ts exports AUTH_KEY, WELCOME_KEY, validatePassword. Check that navigation.ts exports navigationGroups with 4 groups (6 items total) and breadcrumbMap with 6 entries.
  </verify>
  <done>
Three files exist with correct exports. TypeScript compiles. navigationGroups has 4 groups with 6 total items. breadcrumbMap has 6 route entries. useAuth hook handles null/true/false states with sessionStorage guarded in useEffect.
  </done>
</task>

<task type="auto">
  <name>Task 2: Login page with D3 graph, route group, 6 page stubs</name>
  <files>src/app/login/page.tsx, src/components/layout/login-graph.tsx, src/app/(authenticated)/layout.tsx, src/app/(authenticated)/page.tsx, src/app/(authenticated)/monitoring/dgraph/page.tsx, src/app/(authenticated)/monitoring/gpu/page.tsx, src/app/(authenticated)/workspace/studio/page.tsx, src/app/(authenticated)/workspace/query/page.tsx, src/app/(authenticated)/admin/users/page.tsx, src/app/page.tsx</files>
  <action>
**Delete/replace `src/app/page.tsx`:** The existing root page.tsx must be removed or replaced since the dashboard will now live at `src/app/(authenticated)/page.tsx`. Delete or replace with a redirect to `/login` (the (authenticated) route group's page.tsx will handle `/`). Actually, since the `(authenticated)` route group is parenthesized, `(authenticated)/page.tsx` will serve `/`. So the existing `src/app/page.tsx` would conflict. **Delete `src/app/page.tsx`** to avoid route conflict.

**src/app/login/page.tsx:** Per user locked decisions:
- `"use client"` directive
- Split-screen layout: `flex h-screen` container
- Left panel (`w-1/2`): dark background (`bg-background`), centered form
  - eXemble logo: Use inline SVG text "eXemble" with eXemble brand styling (white text, font-bold, text-2xl). No external logo file needed for POC.
  - Subtitle text: "Ontology Platform" in smaller text below logo
  - Password input (shadcn Input, type="password", placeholder="비밀번호")
  - Login button (shadcn Button, full-width, text="로그인")
  - Error text: red inline below input, "비밀번호가 일치하지 않습니다" (only when error state is set). Use `text-destructive` class.
  - No additional text per user decision: minimal
- Right panel (`w-1/2`): `LoginGraph` component with dark background
- Uses `useAuth()` hook: if `isAuthenticated === true`, redirect to `/` via `router.replace("/")`
- On form submit: call `login(password)`, if false set error state
- While `isAuthenticated === null`, render nothing (prevent FOUC)

**src/components/layout/login-graph.tsx:** Per user decision (D3 ontology graph preview) and Claude's discretion for style:
- `"use client"` directive
- Decorative (non-interactive) D3 force-directed graph showing 6 ontology types
- Nodes: 6 ontology type circles (Equipment, Process, Wafer, Recipe, Defect, MaintenanceRecord)
  - Radius proportional to relative node count (normalized to 15-35px range)
  - Fill: use CSS variable colors `--color-blue-04` to `--color-cyan-04` range, opacity 0.7
  - Glow effect: SVG filter with feGaussianBlur for soft glow
- Links: actual relations from studio-data.ts type seeds (Equipment->Process, Process->Wafer, Process->Recipe, Wafer->Defect, Defect->Equipment, MaintenanceRecord->Equipment)
  - Thin lines (strokeWidth 1-1.5), color `--color-gray-06`, opacity 0.3-0.4
- Labels: type names in small text (10-11px), white with opacity 0.6-0.7
- Animation: `simulation.alphaTarget(0.02)` for gentle continuous drift
- Responsive: SVG fills container, uses ResizeObserver for sizing
- Cleanup: `simulation.stop()` in useEffect cleanup to prevent memory leak (Pitfall 7)
- No drag, zoom, click, or tooltip handlers (purely decorative per research anti-patterns)
- Background: transparent (parent provides dark bg)

**src/app/(authenticated)/layout.tsx:**
- `"use client"` directive
- Imports `useAuth()` hook
- Auth guard: if `isAuthenticated === null` -> loading state (centered "Loading..." with `text-muted-foreground`). If `isAuthenticated === false` -> redirect to `/login` via `router.replace`. If `true` -> render children.
- For now (Plan 01), just render `<main>{children}</main>` directly. Plan 02 will add SidebarProvider + AppSidebar + HeaderBar wrapper. This keeps Plan 01 focused on auth+routing.
- Import `useRouter` and `useEffect` for redirect logic.

**6 page stubs** (all follow same pattern):
- Each file: `export default function PageName() { return <div className="flex flex-1 items-center justify-center"><h1 className="text-2xl font-semibold text-muted-foreground">[Page Title]</h1></div> }`
- Page titles: "Ontology Dashboard", "DGraph Monitoring", "GPU Monitoring", "Ontology Studio", "Query Console", "User Management"
- These are simple stubs. Phase 3-7 will replace with real content.
  </action>
  <verify>
1. Run `npx tsc --noEmit` to confirm no type errors.
2. Run `npm run dev` and verify:
   - Navigating to `http://localhost:3000/` redirects to `/login`
   - Login page shows split layout with password form on left
   - Entering wrong password shows red error text
   - Entering "exem123" redirects to `/` showing dashboard stub
   - Navigate to all 6 routes manually and confirm stub pages render
   - The D3 graph animates on the right panel of login
3. Run `npm run build` to confirm no build errors.
  </verify>
  <done>
Login page renders with left form + right D3 graph. Wrong password shows "비밀번호가 일치하지 않습니다". Correct password redirects to dashboard. All 6 routes serve stub pages. Unauthenticated access to any route redirects to /login. No TypeScript or build errors.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. `npm run build` succeeds
3. Auth flow: unauthenticated -> redirected to /login -> enter password -> redirected to /
4. All 6 routes accessible when authenticated: /, /monitoring/dgraph, /monitoring/gpu, /workspace/studio, /workspace/query, /admin/users
5. Login page visual: split layout, minimal form left, D3 graph right
6. Error state: wrong password shows red inline text
7. Session: closing browser tab and reopening clears auth (sessionStorage)
</verification>

<success_criteria>
- Password gate blocks all unauthenticated access and allows entry with correct password
- 6 URL paths resolve to distinct stub pages within authenticated route group
- Login page shows eXemble-branded split layout with decorative D3 ontology graph
- No TypeScript errors, no build errors, no hydration warnings
</success_criteria>

<output>
After completion, create `.planning/phases/02-layout-shell/02-01-SUMMARY.md`
</output>
