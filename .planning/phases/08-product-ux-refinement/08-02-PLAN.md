---
phase: 08-product-ux-refinement
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/layout/header-bar.tsx
  - src/components/layout/AlertBell.tsx
autonomous: true
requirements:
  - UXR-07

must_haves:
  truths:
    - "Header bar has a bell icon button that shows unresolved alert count"
    - "Clicking the bell opens a dropdown/popover with alert history list"
    - "Each alert shows severity badge, message, and relative timestamp"
    - "Unresolved alerts show a red dot indicator on the bell icon"
  artifacts:
    - path: "src/components/layout/AlertBell.tsx"
      provides: "Bell icon + alert history popover dropdown"
      min_lines: 40
    - path: "src/components/layout/header-bar.tsx"
      provides: "Updated header with AlertBell integrated"
      contains: "AlertBell"
  key_links:
    - from: "src/components/layout/AlertBell.tsx"
      to: "src/data/dashboard-data.ts"
      via: "getDashboardAlerts() for alert data"
      pattern: "getDashboardAlerts"
    - from: "src/components/layout/header-bar.tsx"
      to: "src/components/layout/AlertBell.tsx"
      via: "Component import and render"
      pattern: "AlertBell"
---

<objective>
Add a notification bell icon to the header bar with an alert history dropdown, enabling operators to quickly see anomaly alerts from any page.

Purpose: Provides persistent alert visibility across all pages â€” operators see alert counts and can drill into alert history without navigating to the dashboard.
Output: AlertBell component with popover, updated HeaderBar integration.
</objective>

<execution_context>
@/Users/chs/.claude/get-shit-done/workflows/execute-plan.md
@/Users/chs/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/components/layout/header-bar.tsx
@src/data/dashboard-data.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create AlertBell component with popover dropdown</name>
  <files>
    src/components/layout/AlertBell.tsx
  </files>
  <action>
Create `src/components/layout/AlertBell.tsx` as `"use client"` component:

1. Import shadcn `Popover`, `PopoverContent`, `PopoverTrigger` from `@/components/ui/popover`.
2. Import `Button` from `@/components/ui/button`.
3. Import `Badge` from `@/components/ui/badge`.
4. Import `Bell` from `lucide-react`.
5. Import `getDashboardAlerts` from `@/data/dashboard-data`.

6. Component renders:
   - `Popover` wrapping a `PopoverTrigger` with a ghost icon `Button` (size="icon", className="relative h-8 w-8")
   - `Bell` icon (size 4)
   - Red dot indicator: `{unresolvedCount > 0 && <span className="absolute top-1 right-1 size-2 rounded-full bg-destructive" />}`
   - `PopoverContent` aligned to "end", width 80 (w-80), padding 0

7. Alert list inside PopoverContent:
   - Header: "Notifications" title + unresolved count badge
   - ScrollArea (or max-h-80 overflow-auto) containing alert items
   - Each alert item: severity badge (error=destructive, warning=custom-amber, info=secondary), message text, relative time (reuse formatRelativeTime pattern from Phase 3)
   - Resolved alerts show muted text
   - Empty state if no alerts: "No notifications" text

8. Use `sonner` toast for new anomaly alerts (import `toast` from `sonner`):
   - On mount, if there are unresolved alerts, show a toast for the most recent one
   - Use `useEffect` with empty deps to fire once
  </action>
  <verify>
    - File exists at `src/components/layout/AlertBell.tsx`
    - Contains Popover + Bell icon + getDashboardAlerts usage
    - `npx tsc --noEmit` passes
  </verify>
  <done>AlertBell shows bell icon with red dot when unresolved alerts exist, popover dropdown lists all alerts with severity/time, toast fires for newest alert on mount</done>
</task>

<task type="auto">
  <name>Task 2: Integrate AlertBell into HeaderBar and add role indicator</name>
  <files>
    src/components/layout/header-bar.tsx
  </files>
  <action>
Update `src/components/layout/header-bar.tsx`:

1. Import `AlertBell` from `@/components/layout/AlertBell`.
2. Import `useRole` from the RoleContext (established in Phase 6).
3. Import `Badge` from `@/components/ui/badge`.

4. Add AlertBell to the header's right section, before the existing CmdK hint button:
   - Position: `<AlertBell />` in the flex row of header actions

5. Add role indicator badge next to AlertBell:
   - Use `useRole()` to get current role
   - Render a small `Badge` showing the role name with established role color mapping:
     - super_admin: red variant
     - service_app: blue
     - data_analyst: gray
     - auditor: outline
   - Format role display: replace underscores with spaces, title case

6. Maintain existing breadcrumb and namespace selector functionality.

7. Header action ordering (left to right in the right section):
   - Role badge (small, subtle)
   - AlertBell
   - Cmd+K hint button (existing)
  </action>
  <verify>
    - `grep "AlertBell" src/components/layout/header-bar.tsx` finds import + usage
    - `grep "useRole" src/components/layout/header-bar.tsx` finds role import
    - `npm run build` succeeds
  </verify>
  <done>HeaderBar displays role badge + AlertBell + CmdK hint in right section; bell shows notification count; role badge reflects current RoleContext state</done>
</task>

</tasks>

<verification>
- AlertBell.tsx exists and uses Popover + Bell + getDashboardAlerts
- header-bar.tsx imports and renders AlertBell
- Role badge visible in header
- `npm run build` passes
</verification>

<success_criteria>
- Bell icon visible in header bar on all authenticated pages
- Red dot appears when unresolved alerts exist
- Clicking bell shows dropdown with alert history
- Role badge displays current role with color coding
</success_criteria>

<output>
After completion, create `.planning/phases/08-product-ux-refinement/08-02-SUMMARY.md`
</output>
