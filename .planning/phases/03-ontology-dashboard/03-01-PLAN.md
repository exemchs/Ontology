---
phase: 03-ontology-dashboard
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/data/dashboard-data.ts
  - src/types/index.ts
  - src/components/ui/accordion.tsx
  - src/app/(authenticated)/page.tsx
  - src/components/charts/dashboard/MetricCard.tsx
  - src/components/charts/dashboard/RecentAlerts.tsx
autonomous: true
requirements:
  - DASH-01
  - DASH-07

must_haves:
  truths:
    - "4개 메트릭 카드(Total Nodes, Relations, Query Rate, Uptime)가 숫자, 단위, 트렌드 아이콘과 함께 표시된다"
    - "최근 5건 알림이 severity 배지 + 상대 시간 + 메시지로 표시된다"
    - "알림 클릭 시 accordion 확장으로 노드명, 상세 메시지, resolved 여부가 보이고 한 번에 하나만 확장된다"
    - "대시보드 페이지 grid 레이아웃이 7개 차트 영역의 배치를 구성한다"
  artifacts:
    - path: "src/data/dashboard-data.ts"
      provides: "getDashboardScatterData, getDashboardResourceBars, getDashboardAlerts added"
      contains: "getDashboardAlerts"
    - path: "src/types/index.ts"
      provides: "ScatterPoint, ResourceBarData types added"
      contains: "ScatterPoint"
    - path: "src/components/ui/accordion.tsx"
      provides: "shadcn accordion component for RecentAlerts"
    - path: "src/app/(authenticated)/page.tsx"
      provides: "Dashboard page with 2-column grid layout and all component slots"
      min_lines: 60
    - path: "src/components/charts/dashboard/MetricCard.tsx"
      provides: "Single metric card with value, unit, trend icon, change rate"
      min_lines: 30
    - path: "src/components/charts/dashboard/RecentAlerts.tsx"
      provides: "Accordion alert list with severity badges and expandable details"
      min_lines: 40
  key_links:
    - from: "src/app/(authenticated)/page.tsx"
      to: "src/components/charts/dashboard/MetricCard.tsx"
      via: "import and render with getDashboardMetrics() data"
      pattern: "MetricCard"
    - from: "src/app/(authenticated)/page.tsx"
      to: "src/components/charts/dashboard/RecentAlerts.tsx"
      via: "import and render with getDashboardAlerts() data"
      pattern: "RecentAlerts"
    - from: "src/components/charts/dashboard/RecentAlerts.tsx"
      to: "src/components/ui/accordion.tsx"
      via: "import Accordion components"
      pattern: "AccordionItem"
---

<objective>
Install Phase 3 dependencies (d3-sankey, shadcn accordion), fill data gaps in dashboard-data.ts, add missing types, then build the dashboard page layout scaffold with MetricCards and RecentAlerts.

Purpose: Establish the foundation for all Phase 3 charts. The page layout defines the grid structure, the data functions provide the inputs, and the two React-only components (MetricCards, RecentAlerts) validate the page scaffold works end-to-end before D3 charts are added.
Output: Working dashboard page with 4 metric cards at top, 5 placeholder slots for D3 charts in the middle, and a working accordion alert list at bottom.
</objective>

<execution_context>
@/Users/chs/.claude/get-shit-done/workflows/execute-plan.md
@/Users/chs/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-ontology-dashboard/03-RESEARCH.md

@src/data/dashboard-data.ts
@src/data/studio-data.ts
@src/types/index.ts
@src/components/charts/shared/chart-utils.ts
@src/components/charts/shared/ChartSkeleton.tsx
@src/components/charts/shared/ChartEmpty.tsx
@src/app/(authenticated)/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install dependencies, add data gaps, add types</name>
  <files>
    src/data/dashboard-data.ts
    src/types/index.ts
    src/components/ui/accordion.tsx
  </files>
  <action>
    1. Install d3-sankey and types: `npm install d3-sankey && npm install -D @types/d3-sankey`
    2. Install shadcn accordion: `npx shadcn@latest add accordion` (creates src/components/ui/accordion.tsx)
    3. Add to src/types/index.ts after the Chart Data Types section:

    ```typescript
    // ─── Dashboard Chart Types ─────────────────────────────────────────────────

    export interface ScatterPoint {
      name: string;
      latency: number;
      throughput: number;
      status: NodeStatus;
    }

    export interface ResourceBarData {
      name: string;
      cpu: number;
      memory: number;
      disk: number;
    }
    ```

    4. Add three new exported functions to src/data/dashboard-data.ts:

    a) `getDashboardScatterData(): ScatterPoint[]` — 12 nodes (sks-zero-01 through sks-compute-04) with latency (1-8ms range) and throughput (500-1200 ops/sec range), status based on latency thresholds (>5ms = warning, >7ms = error, else healthy). Apply addJitter. Import ScatterPoint and NodeStatus from @/types.

    b) `getDashboardResourceBars(): ResourceBarData[]` — 12 nodes with cpu (30-85%), memory (40-80%), disk (35-70%) base values with addJitter. Short node names (e.g., "zero-01", "zero-02", "alpha-01").

    c) `getDashboardAlerts(): Alert[]` — 5 alerts with mixed severity (2 error, 2 warning, 1 info). Include realistic messages about Dgraph cluster events (high CPU, memory threshold, disk warning, replication lag, health check). Set clusterId=1. Some resolved=true with resolvedAt timestamps, some resolved=false. Import Alert from @/types.

    Also update getDashboardTimeSeries() to accept an optional `interval: "hourly" | "daily"` parameter. "hourly" (default) = 24 points at 5-min intervals. "daily" = 24 points at 60-min intervals (use intervalMinutes=60 in generateTimeSeriesData call).
  </action>
  <verify>
    `npx tsc --noEmit` passes. `npm ls d3-sankey` shows installed version. `ls src/components/ui/accordion.tsx` confirms accordion exists.
  </verify>
  <done>d3-sankey installed, accordion component exists, ScatterPoint and ResourceBarData types defined, dashboard-data.ts exports getDashboardScatterData, getDashboardResourceBars, getDashboardAlerts, and getDashboardTimeSeries accepts interval parameter.</done>
</task>

<task type="auto">
  <name>Task 2: Dashboard page layout + MetricCard + RecentAlerts</name>
  <files>
    src/components/charts/dashboard/MetricCard.tsx
    src/components/charts/dashboard/RecentAlerts.tsx
    src/app/(authenticated)/page.tsx
  </files>
  <action>
    1. Create `src/components/charts/dashboard/MetricCard.tsx`:
    - "use client" component
    - Props: `{ label: string; value: number; unit: string; change: number; changeLabel: string }`
    - Use shadcn Card component for container
    - Display value in large bold text (text-2xl font-bold) with unit suffix
    - Display trend icon: TrendingUp (lucide-react) if change > 0 (green text), TrendingDown if change < 0 (red text), Minus if change === 0 (muted text)
    - Display change as "+X.X%" or "-X.X%" with changeLabel below
    - Label at top of card in muted text
    - data-testid="metric-card-{label-kebab-case}"

    2. Create `src/components/charts/dashboard/RecentAlerts.tsx`:
    - "use client" component
    - Props: `{ alerts: Alert[] }` (import Alert from @/types)
    - Use shadcn Card as outer container with "Recent Alerts" header
    - Use shadcn Accordion with type="single" collapsible for the list
    - Each AccordionItem shows: severity Badge (error=destructive, warning=amber bg + amber text, info=secondary), relative time (formatRelativeTime helper: "2m ago", "1h ago", "3d ago"), title
    - AccordionContent shows: node name (derive from nodeId: "Node #X"), full message text, resolved Badge (green "Resolved" or red "Active")
    - data-testid="recent-alerts"

    3. Update `src/app/(authenticated)/page.tsx` to create the dashboard layout:
    - "use client" component (needs to call data functions with jitter)
    - Import getDashboardMetrics, getDashboardAlerts from @/data/dashboard-data
    - Import MetricCard, RecentAlerts
    - 2-column grid layout per user decision:
      - Row 1 (full width): 4 MetricCards in a 4-column grid (grid-cols-2 lg:grid-cols-4)
      - Row 2 (full width): 3 gauge placeholders in a 3-column grid (grid-cols-1 lg:grid-cols-3) — render ChartSkeleton with label "Resource Gauges"
      - Row 3 (2 cols): Left = ChartSkeleton "Dual Line Chart", Right = ChartSkeleton "Ontology Relations"
      - Row 4 (2 cols): Left = ChartSkeleton "Node Scatter Plot", Right = ChartSkeleton "Resource Bar Chart"
      - Row 5 (full width): RecentAlerts
    - Use gap-6 between grid items, consistent padding
    - Each chart placeholder wrapped in a shadcn Card with title header and min-h-[300px] for the chart area
    - Page title: "Ontology Dashboard" at top
  </action>
  <verify>
    Run `npm run build` to verify no build errors. Visually confirm (if dev server is running): navigate to dashboard page, see 4 metric cards at top, 5 skeleton placeholders in grid layout, and 5 alerts in accordion at bottom.
  </verify>
  <done>MetricCard renders 4 cards with values, units, and trend icons. RecentAlerts shows 5 items with severity badges and accordion expand showing details (one at a time). Dashboard page has complete 2-column grid layout with placeholder slots for all 5 D3 charts.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` — zero errors
2. `npm run build` — successful production build
3. Dashboard page at `/` (after auth) shows 4 metric cards, 5 chart skeletons, and 5 alert items
4. Clicking an alert expands its details; clicking another collapses the first
5. Severity badges display correct colors (red for error, amber for warning, muted for info)
</verification>

<success_criteria>
- d3-sankey, @types/d3-sankey installed in package.json
- shadcn accordion component at src/components/ui/accordion.tsx
- dashboard-data.ts exports 6 functions (metrics, gauges, timeSeries, scatterData, resourceBars, alerts)
- types/index.ts has ScatterPoint and ResourceBarData interfaces
- Dashboard page renders with correct 2-column grid layout matching user's locked decision
- MetricCards show 4 cards with trend indicators
- RecentAlerts accordion works with single-expand behavior
</success_criteria>

<output>
After completion, create `.planning/phases/03-ontology-dashboard/03-01-SUMMARY.md`
</output>
