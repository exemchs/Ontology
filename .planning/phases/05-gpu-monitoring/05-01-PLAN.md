---
phase: 05-gpu-monitoring
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/index.ts
  - src/data/gpu-data.ts
  - src/app/monitoring/gpu/page.tsx
  - src/components/gpu/GpuSummaryHeader.tsx
  - src/components/gpu/GpuCard.tsx
  - src/components/gpu/GpuCardGrid.tsx
  - src/components/gpu/GpuHealthIssues.tsx
  - src/components/gpu/GpuProcessesTable.tsx
  - src/components/gpu/GpuPerformanceTrend.tsx
  - src/components/gpu/GpuHeatmap.tsx
  - src/components/gpu/GpuRidgeline.tsx
  - src/components/gpu/GpuHeatmapRidgelineToggle.tsx
  - src/components/gpu/GpuComparisonBar.tsx
autonomous: true
requirements: [GPU-01, GPU-02, GPU-07]

must_haves:
  truths:
    - "GPU Summary Header shows total GPU count (4) and average utilization percentage"
    - "4 GPU cards display in a 1x4 horizontal grid showing name, model, status badge, temperature, utilization, memory, power"
    - "Health Issues list shows severity badges (error/warning/info) with messages"
    - "Processes table shows PID, GPU, Memory, Process Name columns"
    - "Health Issues and Processes display side-by-side in a 2-column layout at page bottom"
    - "All D3 chart positions show ChartSkeleton placeholders (ready for Plans 02/03)"
  artifacts:
    - path: "src/types/index.ts"
      provides: "GpuHealthIssue and GpuProcess interfaces"
      contains: "interface GpuHealthIssue"
    - path: "src/data/gpu-data.ts"
      provides: "getGpuHealthIssues() and getGpuProcesses() functions"
      exports: ["getGpuHealthIssues", "getGpuProcesses"]
    - path: "src/app/monitoring/gpu/page.tsx"
      provides: "GPU Monitoring page with full layout structure"
      min_lines: 40
    - path: "src/components/gpu/GpuSummaryHeader.tsx"
      provides: "Summary header with GPU count and average utilization"
      min_lines: 15
    - path: "src/components/gpu/GpuCard.tsx"
      provides: "Individual GPU card with metric bars"
      min_lines: 40
    - path: "src/components/gpu/GpuCardGrid.tsx"
      provides: "1x4 grid container for GPU cards"
      min_lines: 10
    - path: "src/components/gpu/GpuHealthIssues.tsx"
      provides: "Health issues list with severity badges"
      min_lines: 30
    - path: "src/components/gpu/GpuProcessesTable.tsx"
      provides: "Processes table with PID/GPU/Memory/Name"
      min_lines: 30
  key_links:
    - from: "src/app/monitoring/gpu/page.tsx"
      to: "src/data/gpu-data.ts"
      via: "imports getGpuCards, getGpuTimeSeries, getGpuHeatmap, getGpuComparison, getGpuHealthIssues, getGpuProcesses"
      pattern: "import.*from.*@/data/gpu-data"
    - from: "src/components/gpu/GpuCard.tsx"
      to: "src/types/index.ts"
      via: "imports Gpu type"
      pattern: "import.*Gpu.*from.*@/types"
    - from: "src/components/gpu/GpuHealthIssues.tsx"
      to: "src/types/index.ts"
      via: "imports GpuHealthIssue type"
      pattern: "import.*GpuHealthIssue.*from.*@/types"
---

<objective>
GPU Monitoring page foundation: data layer extensions, page layout, and all React-only components (summary header, GPU cards, health issues, processes table). D3 chart components are created as stub placeholders showing ChartSkeleton, ready for Plans 02 and 03 to implement.

Purpose: Establish the complete page structure and all non-D3 components so that Plans 02/03 can focus purely on D3 chart implementation without touching the page layout.
Output: Working GPU monitoring page at /monitoring/gpu with functional React components and placeholder D3 chart areas.
</objective>

<execution_context>
@/Users/chs/.claude/get-shit-done/workflows/execute-plan.md
@/Users/chs/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-gpu-monitoring/05-CONTEXT.md
@.planning/phases/05-gpu-monitoring/05-RESEARCH.md
@.planning/phases/01-foundation-data-layer/01-03-SUMMARY.md
@.planning/phases/01-foundation-data-layer/01-04-SUMMARY.md
@src/types/index.ts
@src/data/gpu-data.ts
@src/components/charts/shared/ChartSkeleton.tsx
@src/components/ui/card.tsx
@src/components/ui/badge.tsx
@src/components/ui/table.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Data layer extensions + Type definitions</name>
  <files>src/types/index.ts, src/data/gpu-data.ts</files>
  <action>
1. In `src/types/index.ts`, add two new interfaces after the existing GPU Types section:

```typescript
export interface GpuHealthIssue {
  id: number;
  gpuName: string;
  severity: "error" | "warning" | "info";
  message: string;
  timestamp: Date;
}

export interface GpuProcess {
  pid: number;
  gpuName: string;
  processName: string;
  memoryUsed: number;    // in MB
  gpuUtilization: number; // percentage
  type: "C" | "G";       // Compute or Graphics
}
```

2. In `src/data/gpu-data.ts`, add two new exported functions at the bottom of the file (after `getGpuComparison()`):

- `getGpuHealthIssues(): GpuHealthIssue[]` — Returns 5-7 health issue items with realistic GPU monitoring messages. Include at least 1 error (e.g., "GPU-2 temperature exceeding threshold"), 2 warnings (e.g., memory nearing capacity, ECC error count), and 2-3 info items. Timestamps should be relative to `new Date()` going back a few hours.

- `getGpuProcesses(): GpuProcess[]` — Returns 7 process entries across the 4 GPUs. Use realistic ML workload process names: `python3 train_model.py`, `python3 inference.py`, `python3 fine_tune.py`, `tensorboard`, `nvidia-smi monitor`, etc. Memory values in MB (range 200-32000), utilization 1-82%. Apply jitter to memoryUsed and gpuUtilization using the existing `addJitter()` and `round()` helpers.

Import the new types: `import type { Gpu, GpuStatus, TimeSeriesPoint, GpuHealthIssue, GpuProcess } from "@/types";`
  </action>
  <verify>Run `npx tsc --noEmit` — no type errors. Verify the new functions are exported by checking: `grep -n "export function getGpu" src/data/gpu-data.ts` shows getGpuCards, getGpuTimeSeries, getGpuHeatmap, getGpuComparison, getGpuHealthIssues, getGpuProcesses.</verify>
  <done>GpuHealthIssue and GpuProcess types exist in types/index.ts. getGpuHealthIssues() returns 5-7 items with severity badges. getGpuProcesses() returns 7 items with jittered values. TypeScript compiles cleanly.</done>
</task>

<task type="auto">
  <name>Task 2: GPU page layout + React components (Summary, Cards, Health, Processes)</name>
  <files>src/components/gpu/GpuSummaryHeader.tsx, src/components/gpu/GpuCard.tsx, src/components/gpu/GpuCardGrid.tsx, src/components/gpu/GpuHealthIssues.tsx, src/components/gpu/GpuProcessesTable.tsx</files>
  <action>
Create 5 React components in `src/components/gpu/`. All are `"use client"` components.

**GpuSummaryHeader.tsx** — Accepts `gpus: Gpu[]` prop. Displays:
- Title "GPU Monitoring" on the left
- On the right: "4 GPUs" count and average utilization as a colored badge (green < 60%, amber 60-80%, red > 80%). Use shadcn Badge.
- Compute average utilization from the gpus array: `gpus.reduce((sum, g) => sum + g.utilization, 0) / gpus.length`

**GpuCard.tsx** — Accepts `gpu: Gpu` prop. Per user decision: shows GPU name, model, status badge, temperature, utilization, memory, power. Design (Claude's discretion):
- Use shadcn Card with compact padding (p-4)
- Header row: GPU name (font-semibold) + model (text-xs muted) on left, status Badge on right
- Status badge colors: healthy=green, warning=amber, error=red (use variant="outline" with custom className for bg/text/border)
- 4 mini metric bars below: Utilization %, Temperature C, Memory %, Power %
- Each metric bar: small icon (use lucide-react: Cpu, Thermometer, HardDrive, Zap), label, horizontal progress bar (div with percentage width), value text
- Bar colors: green < 60%, amber 60-80%, red > 80%
- Add `data-testid={`gpu-card-${gpu.id}`}`

**GpuCardGrid.tsx** — Accepts `gpus: Gpu[]` prop. Renders a `grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-4` container mapping gpus to GpuCard components. Per user decision: 1x4 horizontal layout (xl breakpoint).

**GpuHealthIssues.tsx** — Accepts `issues: GpuHealthIssue[]` prop. Per user decision: left column of bottom 2-column layout.
- Use shadcn Card with "Health Issues" title in CardHeader
- List each issue with: severity Badge (error=red destructive, warning=amber, info=blue/default), GPU name in muted text, message, relative timestamp (e.g., "2h ago")
- Calculate relative time from `issue.timestamp` to now
- Show max 6 items (sort by timestamp descending, most recent first)
- Add `data-testid="gpu-health-issues"`

**GpuProcessesTable.tsx** — Accepts `processes: GpuProcess[]` prop. Per user decision: right column of bottom 2-column layout, columns: PID, GPU, Memory, Name.
- Use shadcn Card wrapping shadcn Table
- Columns: PID (tabular-nums), GPU (Badge outline), Memory (format as "24.5 GB" if > 1024 MB, else "256 MB"), Process Name (font-mono text-xs truncate), Type badge (C=blue, G=green)
- CardHeader title: "GPU Processes"
- Add `data-testid="gpu-processes-table"`
  </action>
  <verify>Run `npx tsc --noEmit` — no type errors on any of the 5 component files. Verify files exist: `ls src/components/gpu/` shows all 5 files.</verify>
  <done>5 React components render GPU monitoring data using shadcn Card/Badge/Table. Cards display in 1x4 grid. Health issues show severity badges. Processes table shows PID/GPU/Memory/Name.</done>
</task>

<task type="auto">
  <name>Task 3: GPU page + D3 chart stub components</name>
  <files>src/app/monitoring/gpu/page.tsx, src/components/gpu/GpuPerformanceTrend.tsx, src/components/gpu/GpuHeatmap.tsx, src/components/gpu/GpuRidgeline.tsx, src/components/gpu/GpuHeatmapRidgelineToggle.tsx, src/components/gpu/GpuComparisonBar.tsx</files>
  <action>
Create 5 D3 chart stub components + the page file.

**D3 Stub Components** — Each stub is a `"use client"` component that accepts the correct props (matching what the real implementation will need) and renders a `ChartSkeleton` inside a shadcn Card. This ensures the page compiles and renders with correct layout while Plans 02/03 implement the real D3 logic.

Stub template for each:
```tsx
"use client";
import { Card, CardHeader, CardContent, CardTitle } from "@/components/ui/card";
import { ChartSkeleton } from "@/components/charts/shared/ChartSkeleton";

interface Props { /* correct prop types */ }

export function ComponentName({ ...props }: Props) {
  return (
    <Card>
      <CardHeader><CardTitle>Chart Title</CardTitle></CardHeader>
      <CardContent><ChartSkeleton /></CardContent>
    </Card>
  );
}
```

Create these stubs with correct interfaces:
- `GpuPerformanceTrend.tsx` — props: `{ series: GpuTimeSeries[] }` — title: "Performance Trends"
- `GpuHeatmap.tsx` — props: `{ data: GpuHeatmapCell[] }` — title: "GPU Utilization Heatmap"
- `GpuRidgeline.tsx` — props: `{ data: GpuTimeSeries[] }` — title: "GPU Utilization Density"
- `GpuHeatmapRidgelineToggle.tsx` — props: `{ heatmapData: GpuHeatmapCell[], timeSeriesData: GpuTimeSeries[] }` — renders the toggle Switch between Heatmap/Ridgeline labels, conditionally renders GpuHeatmap or GpuRidgeline based on state. Uses `useState(false)` for `showRidgeline`. Import Switch from shadcn. This component should be FULLY implemented (not a stub) since it's React-only logic.
- `GpuComparisonBar.tsx` — props: `{ data: GpuComparisonItem[] }` — title: "GPU Comparison"

Import types from `@/data/gpu-data` (for GpuTimeSeries, GpuHeatmapCell, GpuComparisonItem) and `@/types` (for Gpu).

**Page file: `src/app/monitoring/gpu/page.tsx`** — Server component (no "use client"). Calls all data functions, passes data to components.

Layout structure (per user decision):
```
[GpuSummaryHeader]                    ← full width
[GpuCardGrid]                         ← 1x4 grid
[GpuPerformanceTrend]                 ← full width card
[GpuHeatmapRidgelineToggle]           ← full width card (toggle inside)
[GpuComparisonBar]                    ← full width card
[GpuHealthIssues | GpuProcessesTable] ← 2-column grid (lg:grid-cols-2)
```

Page layout: `<div className="flex flex-col gap-6 p-6">` wrapping all sections. Bottom section uses `<div className="grid grid-cols-1 lg:grid-cols-2 gap-6">`.

Add `export const metadata = { title: "GPU Monitoring - eXemble Ontology" }` for Next.js page metadata.
  </action>
  <verify>Run `npx tsc --noEmit` — page compiles with all component imports resolved. Run `npm run build` to verify the route /monitoring/gpu builds successfully. Check the page renders: `curl -s http://localhost:3000/monitoring/gpu | head -20` (if dev server available) or verify build output shows the route.</verify>
  <done>GPU Monitoring page exists at /monitoring/gpu with complete layout. All React components render real data. D3 chart positions show ChartSkeleton placeholders. HeatmapRidgelineToggle switches between heatmap/ridgeline stubs. Page builds without errors.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. `npm run build` completes and /monitoring/gpu route is in the build output
3. All 13 files exist in their expected locations
4. GpuHealthIssue and GpuProcess types are exported from src/types/index.ts
5. getGpuHealthIssues() and getGpuProcesses() are exported from src/data/gpu-data.ts
6. Page layout matches the specified grid structure
</verification>

<success_criteria>
- GPU Monitoring page renders at /monitoring/gpu
- Summary header shows "4 GPUs" and average utilization badge
- 4 GPU cards display in horizontal grid with name/model/status/metrics
- Health Issues and Processes Table render side-by-side at bottom
- D3 chart areas show skeleton placeholders
- Heatmap/Ridgeline toggle switches between two skeleton views
- TypeScript and build pass cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/05-gpu-monitoring/05-01-SUMMARY.md`
</output>
