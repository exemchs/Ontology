---
phase: 01-foundation-data-layer
plan: 04
type: execute
wave: 2
depends_on: ["01-02"]
files_modified:
  - src/data/dashboard-data.ts
  - src/data/dgraph-data.ts
  - src/data/gpu-data.ts
  - src/data/studio-data.ts
  - src/data/query-data.ts
  - src/data/pii-config.ts
  - src/lib/pii-masking.ts
autonomous: true
requirements:
  - DATA-03
  - DATA-04

must_haves:
  truths:
    - "dashboard/dgraph/gpu/studio/query 5개 데이터 파일이 TypeScript 타입과 함께 import 가능하다"
    - "데이터 함수 호출 시 addJitter로 미세한 변동이 적용되어 살아있는 데이터 느낌을 준다"
    - "PII 데모 데이터에 FAB Equipment 8행 + General 5행이 포함되고 역할별 마스킹 함수가 동작한다"
  artifacts:
    - path: "src/data/dashboard-data.ts"
      provides: "Dashboard page metrics and chart data"
      exports: ["getDashboardMetrics", "getDashboardGauges", "getDashboardTimeSeries"]
      min_lines: 30
    - path: "src/data/dgraph-data.ts"
      provides: "DGraph cluster topology and node metrics"
      exports: ["getDgraphNodes", "getDgraphLinks", "getDgraphShards"]
      min_lines: 30
    - path: "src/data/gpu-data.ts"
      provides: "GPU cards, performance trends, heatmap data"
      exports: ["getGpuCards", "getGpuTimeSeries", "getGpuHeatmap"]
      min_lines: 30
    - path: "src/data/studio-data.ts"
      provides: "6 ontology types with predicates and relations"
      exports: ["getOntologyTypes", "getTypeDistribution"]
      min_lines: 20
    - path: "src/data/query-data.ts"
      provides: "Query templates, history, PII demo data"
      exports: ["getQueryTemplates", "getQueryHistory", "getPiiDemoData"]
      min_lines: 40
    - path: "src/data/pii-config.ts"
      provides: "PII field configs and masking rules per role"
      exports: ["fabPiiFieldConfigs", "generalPiiFieldConfigs"]
      min_lines: 20
    - path: "src/lib/pii-masking.ts"
      provides: "PII masking functions"
      exports: ["maskName", "maskPhone", "maskEmail", "maskId", "maskAddress"]
      min_lines: 30
  key_links:
    - from: "src/data/*.ts"
      to: "src/types/index.ts"
      via: "TypeScript type imports"
      pattern: "import.*from.*@/types"
    - from: "src/data/query-data.ts"
      to: "src/data/pii-config.ts"
      via: "PII config references"
      pattern: "import.*pii-config"
    - from: "src/data/pii-config.ts"
      to: "src/lib/pii-masking.ts"
      via: "Masking function references"
      pattern: "import.*pii-masking"
---

<objective>
클라이언트 하드코딩 데이터 파일 5종 + PII 마스킹 시스템 구축

Purpose: 6개 페이지가 사용할 하드코딩 데이터를 TypeScript 타입 기반으로 준비한다. 각 데이터 파일은 함수 형태로 export하여 호출 시마다 addJitter로 미세한 변동을 적용, '살아있는' 모니터링 데이터 느낌을 제공한다. PII 데모 데이터와 역할별 마스킹 함수로 RBAC 시연 기반을 마련한다.

Output: 5개 데이터 파일 (dashboard/dgraph/gpu/studio/query), pii-config.ts, pii-masking.ts
</objective>

<execution_context>
@/Users/chs/.claude/get-shit-done/workflows/execute-plan.md
@/Users/chs/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-data-layer/01-RESEARCH.md (data jitter pattern, PII demo data structure)
@.planning/phases/01-foundation-data-layer/01-02-SUMMARY.md (TypeScript types available)
@/Users/chs/Downloads/exemble-ontology-docs-v1.3/02_Data-Schema.md (section 3 hardcoded data, section 4 PII demo data)
@/Users/chs/Downloads/exemble-ontology-docs-v1.3/04_Implementation-Guide.md (data file references)
</context>

<tasks>

<task type="auto">
  <name>Task 1: 클라이언트 데이터 파일 5종 (dashboard/dgraph/gpu/studio/query)</name>
  <files>
    src/data/dashboard-data.ts
    src/data/dgraph-data.ts
    src/data/gpu-data.ts
    src/data/studio-data.ts
    src/data/query-data.ts
  </files>
  <action>
    `src/data/` 디렉토리 생성 후 5개 데이터 파일을 작성한다. 모든 파일은 `@/types`에서 타입을 import하고, `addJitter`를 사용할 수 있도록 chart-utils에서 import하거나 inline으로 간단한 jitter 헬퍼를 포함한다.

    **핵심 패턴 (유저 결정 잠금):**
    - 데이터는 함수로 export (호출마다 새 jitter 값 생성)
    - 기본값은 PRD Data Schema에 정의된 그대로
    - 타임스탬프는 현재 시각 기준 상대적으로 생성
    - jitter 범위: 값의 ±3~5%

    **dashboard-data.ts:**
    - `getDashboardMetrics()`: 4종 메트릭 카드 데이터 반환
      - Total Nodes: 12 (+jitter 없음, 정수)
      - Total Relations: 233,452 (+jitter)
      - Query Rate: 1,847/min (+jitter)
      - Uptime: 99.97% (+미세 jitter)
    - `getDashboardGauges()`: CPU/Memory/Disk 게이지 3종
      - CPU: value 45.3, max 100 (+jitter)
      - Memory: value 62.1, max 100 (+jitter)
      - Disk: value 55.8, max 100 (+jitter)
    - `getDashboardTimeSeries()`: Agent Request Rate + Query QPS 시계열
      - 24 포인트 (최근 2시간, 5분 간격), range [800, 2500] 와 [200, 800]
      - generateTimeSeriesData 활용 또는 inline 구현

    **dgraph-data.ts:**
    - `getDgraphNodes()`: 12개 노드 데이터 (ClusterNode 타입 기반, 연구 파일의 시드 데이터 값 활용)
      - 각 노드에 cpu/memory/disk usage + jitter
    - `getDgraphLinks()`: 노드 간 연결 관계 (Zero→Alpha, Alpha→Alpha 등)
      - source/target 형태로 force simulation에 적합한 구조
    - `getDgraphShards()`: 샤드 바 차트용 데이터 (3 groups x 4-6 shards)
    - `getDgraphQueries()`: 쿼리 산점도용 데이터 (50개 포인트, latency x throughput)

    **gpu-data.ts:**
    - `getGpuCards()`: 4개 GPU 카드 데이터 (Gpu 타입 기반, 시드 데이터 값 + jitter)
    - `getGpuTimeSeries()`: 성능 트렌드 멀티라인 데이터 (utilization/temperature/power/memory 4 metrics × 4 GPUs × 24 points)
    - `getGpuHeatmap()`: GPU × Time 매트릭스 (4 GPUs × 24 time slots, utilization 값)
    - `getGpuComparison()`: 4 GPU 비교 바 차트 데이터

    **studio-data.ts:**
    - `getOntologyTypes()`: 6개 온톨로지 타입 (OntologyType 타입, 시드 데이터 값)
      - Equipment(832), Process(24500), Wafer(156000), Recipe(310), Defect(48800), MaintenanceRecord(3820)
      - 각각 predicates와 relations 포함
    - `getTypeDistribution()`: 타입별 Records/Queries 분포 데이터

    **query-data.ts:**
    - `getQueryTemplates()`: GraphQL/DQL 쿼리 템플릿 5종
      - "List all Equipment" (GraphQL)
      - "Equipment by Location" (GraphQL)
      - "Process Steps for Wafer" (DQL)
      - "Defect Analysis" (DQL)
      - "Maintenance Schedule" (GraphQL)
    - `getQueryHistory()`: 최근 쿼리 히스토리 10건
    - `getPiiDemoData()`: PII 데모 데이터 객체 { fab: FabPiiRecord[], general: GeneralPiiRecord[] }
      - **FAB Equipment 8행** (PRD Data Schema section 4.1):
        - equipment_id (PII 없음), operator_name (medium), operator_phone (highest), operator_email (high), location (none), last_calibration (none), maintenance_notes (low), calibration_by (medium)
        - 장비: CVD-001~003, Etcher-001~002, Furnace-001~002, CMP-001
        - 한국 이름/전화번호/이메일 사용
      - **General PII 5행** (PRD Data Schema section 4.2):
        - customer_id (none), name (medium), phone (highest), email (high), address (high), membership (none)
        - 한국 이름/주소/전화 사용

    PII 레코드에 사용할 한국 이름: 김민수, 이영희, 박준호, 최서연, 정하늘, 강도윤, 윤서진, 한미래
    한국 전화번호: 010-XXXX-XXXX 형식
    한국 이메일: @sksiltron.com 도메인
  </action>
  <verify>
    - `npx tsc --noEmit` → 5개 파일 모두 타입 에러 없음
    - `grep "import.*@/types" src/data/dashboard-data.ts` → 타입 import 확인
    - `grep "export function getDashboardMetrics" src/data/dashboard-data.ts` → 함수 export
    - `grep "export function getPiiDemoData" src/data/query-data.ts` → PII 데이터 존재
    - `grep "CVD-001" src/data/query-data.ts` → FAB 장비 데이터 존재
    - `grep "김민수" src/data/query-data.ts` → 한국어 PII 데이터 존재
  </verify>
  <done>
    5개 데이터 파일 모두 TypeScript 타입 기반으로 작성되고, 함수 형태 export, jitter 적용, PII 데모 데이터(FAB 8행 + General 5행) 포함
  </done>
</task>

<task type="auto">
  <name>Task 2: PII 마스킹 설정 + 마스킹 함수 (pii-config + pii-masking)</name>
  <files>
    src/data/pii-config.ts
    src/lib/pii-masking.ts
  </files>
  <action>
    **pii-masking.ts** (`src/lib/`):
    PII 마스킹 순수 함수 5종 구현.

    ```
    maskName(value: string): string
    ```
    - "김민수" → "김*수" (첫 글자 + 마스킹 + 끝 글자)
    - 2글자: "김*", 1글자: "*"

    ```
    maskPhone(value: string): string
    ```
    - "010-1234-5678" → "010-****-5678" (중간 자릿수 마스킹)

    ```
    maskEmail(value: string): string
    ```
    - "kim@sksiltron.com" → "k**@sksiltron.com" (로컬 파트 첫 글자 이후 마스킹)

    ```
    maskId(value: string): string
    ```
    - "CVD-001" → "CVD-***" (하이픈 이후 마스킹)
    - 하이픈 없으면 끝 3글자 마스킹

    ```
    maskAddress(value: string): string
    ```
    - "서울특별시 강남구 테헤란로 123" → "서울특별시 강남구 ***" (구 다음부터 마스킹)
    - 단순 구현: 처음 두 단어 유지, 나머지 마스킹

    추가 함수:
    ```
    anonymize(value: string): string
    ```
    - 항상 "[ANONYMIZED]" 반환

    ```
    deny(): string
    ```
    - 항상 "[ACCESS DENIED]" 반환

    **pii-config.ts** (`src/data/`):
    각 PII 필드의 역할별 마스킹 규칙 정의. maskFn 대신 마스킹 레벨을 정의하고, 역할별 액션을 매핑.

    ```typescript
    type PiiAction = "plain" | "masked" | "anonymized" | "denied";

    interface PiiFieldRule {
      field: string;
      level: PiiLevel;
      actions: Record<Role, PiiAction>;
    }
    ```

    **fabPiiFieldConfigs: PiiFieldRule[]**
    PRD 기준 (4.1):
    | Field | Level | super_admin | service_app | data_analyst | auditor |
    |-------|-------|-------------|-------------|--------------|---------|
    | equipment_id | none | plain | plain | plain | plain |
    | operator_name | medium | plain | plain | masked | denied |
    | operator_phone | highest | plain | masked | denied | denied |
    | operator_email | high | plain | masked | masked | denied |
    | location | none | plain | plain | plain | plain |
    | last_calibration | none | plain | plain | plain | plain |
    | maintenance_notes | low | plain | plain | plain | masked |
    | calibration_by | medium | plain | plain | masked | denied |

    **generalPiiFieldConfigs: PiiFieldRule[]**
    PRD 기준 (4.2):
    | Field | Level | super_admin | service_app | data_analyst | auditor |
    |-------|-------|-------------|-------------|--------------|---------|
    | customer_id | none | plain | plain | plain | plain |
    | name | medium | plain | plain | masked | denied |
    | phone | highest | plain | masked | denied | denied |
    | email | high | plain | masked | masked | denied |
    | address | high | plain | masked | anonymized | denied |
    | membership | none | plain | plain | plain | plain |

    각 field에 대해 어떤 masking 함수를 적용할지 매핑하는 `getMaskFn(field: string)` 도 export:
    - name → maskName, phone → maskPhone, email → maskEmail, operator_name → maskName, etc.
    - 이 함수는 PiiAction이 "masked"일 때 호출될 함수를 결정

    `applyPiiMasking(value: string, field: string, action: PiiAction): string` 유틸 함수:
    - "plain" → value 그대로
    - "masked" → getMaskFn(field)(value)
    - "anonymized" → anonymize(value)
    - "denied" → deny()
  </action>
  <verify>
    - `npx tsc --noEmit` → 타입 에러 없음
    - `grep "export function maskName" src/lib/pii-masking.ts` → 존재
    - `grep "export function maskPhone" src/lib/pii-masking.ts` → 존재
    - `grep "fabPiiFieldConfigs" src/data/pii-config.ts` → FAB 설정 존재
    - `grep "generalPiiFieldConfigs" src/data/pii-config.ts` → General 설정 존재
    - `grep "applyPiiMasking" src/data/pii-config.ts` → 적용 함수 존재
  </verify>
  <done>
    pii-masking.ts에 5종 마스킹 함수(maskName/Phone/Email/Id/Address) + anonymize/deny가 있고, pii-config.ts에 FAB/General PII 필드별 역할 매핑 + applyPiiMasking 유틸이 있고, TypeScript 컴파일 성공
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` → 모든 데이터 파일 + PII 파일 컴파일 성공
2. 7개 파일 모두 `src/data/` 또는 `src/lib/` 에 존재
3. 모든 데이터 파일이 `@/types`에서 타입 import
4. PII 데모 데이터에 한국어 이름/전화/이메일 포함
</verification>

<success_criteria>
- 5개 데이터 파일이 함수 export로 jitter가 적용된 데이터를 반환
- PII 마스킹 함수가 한국어 데이터에 올바르게 동작
- 모든 파일이 TypeScript strict mode 호환
- PRD Data Schema의 FAB 8행 + General 5행 PII 데모 데이터 포함
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-data-layer/01-04-SUMMARY.md`
</output>
