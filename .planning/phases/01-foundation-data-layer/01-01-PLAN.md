---
phase: 01-foundation-data-layer
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/globals.css
  - src/app/layout.tsx
  - src/components/theme-provider.tsx
  - src/components/ui/*.tsx
  - src/lib/utils.ts
  - components.json
  - package.json
  - package-lock.json
autonomous: true
requirements:
  - FOUN-01
  - FOUN-02
  - FOUN-03

must_haves:
  truths:
    - "shadcn/ui 17종 컴포넌트가 설치되고 import 가능하다"
    - "globals.css에 exem-ui primitive + eXemble semantic + shadcn bridge 3계층 CSS 토큰이 정의되어 있다"
    - "다크 모드가 기본값이고 .dark 클래스 토글로 라이트/다크 전환이 된다"
    - "chart series 8색이 CSS 변수로 정의되고 다크/라이트 모드에서 각각 적절한 shade를 사용한다"
  artifacts:
    - path: "src/app/globals.css"
      provides: "Three-tier CSS token system with chart colors"
      contains: "--color-chart-1"
    - path: "src/components/theme-provider.tsx"
      provides: "next-themes ThemeProvider wrapper"
      contains: "NextThemesProvider"
    - path: "src/app/layout.tsx"
      provides: "Root layout with ThemeProvider (defaultTheme=dark)"
      contains: "defaultTheme"
    - path: "components.json"
      provides: "shadcn/ui configuration"
      contains: "aliases"
    - path: "src/lib/utils.ts"
      provides: "cn() utility from shadcn"
      exports: ["cn"]
  key_links:
    - from: "src/app/layout.tsx"
      to: "src/components/theme-provider.tsx"
      via: "ThemeProvider import"
      pattern: "import.*ThemeProvider"
    - from: "src/app/globals.css"
      to: "@theme inline"
      via: "shadcn bridge variables referencing semantic tokens"
      pattern: "--color-background.*var\\(--background\\)"
---

<objective>
shadcn/ui + D3.js 설치, exem-ui 기반 CSS 토큰 시스템 구축, 다크/라이트 테마 시스템 설정

Purpose: Phase 1의 최우선 작업. shadcn/ui + Tailwind CSS 4 호환성을 검증하고, exem-ui 프리미티브 위에 eXemble 블루 액센트 시맨틱 토큰을 올리고, shadcn 브릿지 변수를 연결하여 전체 디자인 시스템의 기반을 완성한다. 다크 모드 기본값 설정과 next-themes 통합까지 포함.

Output: 17종 shadcn 컴포넌트, 3계층 CSS 토큰, ThemeProvider, D3 + next-themes 패키지
</objective>

<execution_context>
@/Users/chs/.claude/get-shit-done/workflows/execute-plan.md
@/Users/chs/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-data-layer/01-RESEARCH.md (CSS token architecture, shadcn init behavior, theme setup)
@/Users/chs/Downloads/exem-ui-main/packages/design-system/stylesheet/src/global.css (exem-ui primitive tokens source)
</context>

<tasks>

<task type="auto">
  <name>Task 1: shadcn/ui 초기화 + 17종 컴포넌트 설치 + D3 + next-themes 설치</name>
  <files>
    components.json
    src/app/globals.css
    src/lib/utils.ts
    src/components/ui/*.tsx
    package.json
    package-lock.json
  </files>
  <action>
    1. `npx shadcn@latest init` 실행. 옵션:
       - Style: "new-york" (if prompted)
       - Base color: Neutral/Zinc (will be overridden by exem-ui tokens)
       - CSS variables: yes
       - Path alias: `@/*` (matches existing tsconfig)
       - 만약 Tailwind version 선택이 나오면 v4 선택

    2. init 완료 후 검증:
       - `components.json` 존재 확인
       - `globals.css`에 `@theme inline` 블록이 있는지 확인 (Tailwind v4 모드)
       - `globals.css`에 `@layer base { :root { --background: 0 0% 100% } }` 형식이면 v3 모드로 잘못 감지된 것 → 수동으로 v4 형식으로 전환 필요
       - `tw-animate-css`가 devDependencies에 있는지 확인 (tailwindcss-animate가 아님)

    3. shadcn/ui 17종 컴포넌트 일괄 설치:
       ```bash
       npx shadcn@latest add button input card badge dialog tabs table select \
         tooltip sidebar command scroll-area separator dropdown-menu breadcrumb \
         collapsible switch
       ```
       Note: PRD에 textarea와 sonner(toaster)도 포함 — 별도 추가:
       ```bash
       npx shadcn@latest add textarea sonner
       ```

    4. D3 + types 설치:
       ```bash
       npm install d3
       npm install -D @types/d3
       ```

    5. next-themes 설치:
       ```bash
       npm install next-themes
       ```

    6. 설치 확인: `npm ls d3 next-themes tw-animate-css` 로 버전 확인

    주의사항:
    - shadcn init이 globals.css를 덮어쓸 수 있음. 기존 내용은 `@import "tailwindcss"` + body font-family뿐이므로 문제없음
    - shadcn init이 tailwind.config.js를 생성하면 Tailwind v3 모드로 잘못 감지된 것. 이 파일 삭제하고 재시도
  </action>
  <verify>
    - `cat components.json` → style, tailwind, aliases 확인
    - `ls src/components/ui/` → 17개 이상의 .tsx 파일 존재
    - `grep "@theme inline" src/app/globals.css` → Tailwind v4 모드 확인
    - `npm ls d3 next-themes` → 버전 출력
    - `npx tsc --noEmit` → TypeScript 컴파일 에러 없음
  </verify>
  <done>
    components.json이 존재하고, src/components/ui/에 17종 컴포넌트 파일이 있고, d3 v7 + @types/d3 + next-themes가 설치되고, globals.css가 Tailwind v4 형식(@theme inline)이다
  </done>
</task>

<task type="auto">
  <name>Task 2: exem-ui 기반 3계층 CSS 토큰 시스템 구축</name>
  <files>
    src/app/globals.css
  </files>
  <action>
    shadcn init이 생성한 globals.css를 기반으로, 3계층 CSS 토큰 시스템을 구축한다.

    **Layer 1: exem-ui Primitive Tokens** — `:root` 블록 상단에 exem-ui global.css의 프리미티브 토큰을 verbatim 복사:
    - `--color-mono-white`, `--color-mono-black`
    - 20개 컬러 스케일 × 11 shade (gray, red, orange, amber, yellow, lime, green, emerald, teal, cyan, sky, blue, indigo, violet, purple, fuchsia, pink, rose) — 총 220개 변수
    - Source: `/Users/chs/Downloads/exem-ui-main/packages/design-system/stylesheet/src/global.css`의 `:root` 섹션 Primitive 부분

    **Layer 2: eXemble Semantic Tokens** — `:root` 블록에 이어서:
    - Text tokens: `--color-text-primary` through `--color-text-critical` (exem-ui 시맨틱 기반이되 accent는 blue-05)
    - Border tokens: `--color-border-primary`, `--color-border-secondary`, `--color-border-accent`(blue-05)
    - Surface tokens: `--color-surface-accent-default`(blue-05), `--color-surface-accent-hovered`(blue-06)
    - Elevation tokens: `--color-elevation-elevation-0`(mono-white) through `--color-elevation-elevation-2`(gray-02)
    - Material tokens: `--color-material-tooltip`(gray-09)
    - Chart axis tokens: `--color-chart-axis-line`(gray-02), `--color-chart-tick`(gray-01), `--color-chart-label`(gray-05)
    - Chart series 8색 (PRD 명세):
      - `--color-chart-1: var(--color-blue-05)` (eXemble 주색)
      - `--color-chart-2: var(--color-emerald-05)`
      - `--color-chart-3: var(--color-amber-05)`
      - `--color-chart-4: var(--color-violet-05)`
      - `--color-chart-5: var(--color-rose-05)`
      - `--color-chart-6: var(--color-cyan-05)`
      - `--color-chart-7: var(--color-orange-05)`
      - `--color-chart-8: var(--color-lime-05)`
    - RBAC/PII tokens: `--color-pii-plain`, `--color-pii-masked`, etc.
    - Role badge tokens: `--color-role-super-admin`(red-05), `--color-role-service-app`(blue-05), etc.
    - Tint background tokens (exem-ui에서 가져옴): `--color-tint-background-amber`, `--color-tint-background-red` 등

    **Layer 3: shadcn/ui Bridge** — shadcn init이 생성한 `:root` 변수들을 semantic 토큰을 참조하도록 수정:
    - `--background: var(--color-elevation-elevation-0)`
    - `--foreground: var(--color-text-primary)`
    - `--primary: var(--color-surface-accent-default)`
    - `--primary-foreground: var(--color-text-inverse)`
    - `--secondary: var(--color-elevation-elevation-1)`
    - `--muted: var(--color-elevation-elevation-1)`
    - `--muted-foreground: var(--color-text-tertiary)`
    - `--destructive: var(--color-red-05)`
    - `--border: var(--color-border-primary)`
    - `--ring: var(--color-blue-05)`
    - Radius: `--radius: 0.5rem` + exem-ui radius tokens (`--radius-weak: 4px`, `--radius-medium: 6px`, `--radius-strong: 8px`)
    - `@theme inline` 블록은 shadcn이 생성한 그대로 유지 (var references)

    **Dark Theme (.dark 블록)** — exem-ui의 `[data-theme='dark']` 토큰을 `.dark` 셀렉터로 변환:
    - 시맨틱 토큰 dark 오버라이드 (text-primary → mono-white, elevation-0 → gray-10, etc.)
    - Chart series dark: `-04` shade 사용 (blue-04, emerald-04, etc.)
    - PII dark 토큰
    - shadcn bridge 변수 중 auto-cascade 안 되는 것만 오버라이드 (--ring: blue-04)

    연구 파일(01-RESEARCH.md)의 "Example 1: globals.css Token Architecture"를 상세 레퍼런스로 참조할 것.

    중요: `@import "tailwindcss"` 와 `@import "tw-animate-css"` 는 파일 최상단에 유지. shadcn이 생성한 `@theme inline` 블록은 파일 하단에 유지.
  </action>
  <verify>
    - `grep "--color-blue-05" src/app/globals.css` → exem-ui primitive 존재
    - `grep "--color-chart-1" src/app/globals.css` → chart series 존재
    - `grep "\.dark" src/app/globals.css` → dark theme 블록 존재
    - `grep "@theme inline" src/app/globals.css` → shadcn bridge 존재
    - `grep "--color-text-accent.*blue" src/app/globals.css` → eXemble blue accent 확인
    - `npm run build` → CSS 파싱 에러 없이 빌드 성공
  </verify>
  <done>
    globals.css에 Layer 1 primitives (220+ 변수), Layer 2 semantics (text/border/surface/elevation/chart/PII/role tokens), Layer 3 shadcn bridge, .dark 블록이 모두 존재하고 빌드가 성공한다
  </done>
</task>

<task type="auto">
  <name>Task 3: ThemeProvider + Root Layout 업데이트 (다크 모드 기본값)</name>
  <files>
    src/components/theme-provider.tsx
    src/app/layout.tsx
  </files>
  <action>
    1. `src/components/theme-provider.tsx` 생성:
       ```typescript
       "use client";
       import * as React from "react";
       import { ThemeProvider as NextThemesProvider } from "next-themes";

       export function ThemeProvider({
         children,
         ...props
       }: React.ComponentProps<typeof NextThemesProvider>) {
         return <NextThemesProvider {...props}>{children}</NextThemesProvider>;
       }
       ```

    2. `src/app/layout.tsx` 업데이트:
       - ThemeProvider import 추가: `import { ThemeProvider } from "@/components/theme-provider"`
       - `<html>` 태그에 `suppressHydrationWarning` 추가 (next-themes 필수)
       - `<body>` 안에 ThemeProvider 래핑:
         ```
         <ThemeProvider
           attribute="class"
           defaultTheme="dark"
           enableSystem={false}
           disableTransitionOnChange
         >
           {children}
         </ThemeProvider>
         ```
       - metadata 업데이트: title → "eXemble Ontology Platform", description → "Graph Database Visualization & Management System"
       - `lang="ko"` 유지 (이미 있음)

    핵심 설정 (유저 결정에 의해 잠금):
    - `defaultTheme="dark"` — 다크 모드 기본값
    - `attribute="class"` — .dark 클래스 기반 (data-theme이 아님)
    - `enableSystem={false}` — OS 테마 무시
    - `disableTransitionOnChange` — D3 차트 리렌더 시 깜빡임 방지
  </action>
  <verify>
    - `cat src/components/theme-provider.tsx` → NextThemesProvider 래핑 확인
    - `grep "defaultTheme" src/app/layout.tsx` → "dark" 값 확인
    - `grep "suppressHydrationWarning" src/app/layout.tsx` → 존재 확인
    - `npx tsc --noEmit` → 타입 에러 없음
    - `npm run build` → 빌드 성공
  </verify>
  <done>
    ThemeProvider가 defaultTheme="dark"로 설정되어 root layout에 적용되고, suppressHydrationWarning이 html 태그에 있고, TypeScript 컴파일과 빌드가 성공한다
  </done>
</task>

</tasks>

<verification>
1. `npm run build` 성공 (CSS 파싱 + TypeScript + 컴포넌트 import 모두 정상)
2. `ls src/components/ui/ | wc -l` >= 17 (shadcn 컴포넌트)
3. `grep -c "^--color-" src/app/globals.css` >= 230 (primitive + semantic 변수)
4. `grep "defaultTheme.*dark" src/app/layout.tsx` → 다크 모드 기본값
5. `npm ls d3 next-themes` → 정상 설치
</verification>

<success_criteria>
- shadcn/ui 17종 컴포넌트가 `@/components/ui/*`에서 import 가능
- globals.css에 3계층 CSS 토큰 (primitive → semantic → shadcn bridge) 구축 완료
- 다크 모드가 기본값이고 ThemeProvider가 root layout에 적용
- D3 v7, next-themes, tw-animate-css가 설치됨
- `npm run build` 성공
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-data-layer/01-01-SUMMARY.md`
</output>
