---
phase: 06-ontology-studio-user-mgmt
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/contexts/RoleContext.tsx
  - src/components/studio/TypeList.tsx
  - src/components/studio/TypeDetail.tsx
  - src/components/studio/TypeEditDialog.tsx
  - src/components/studio/StudioPage.tsx
  - src/app/workspace/studio/page.tsx
autonomous: true
requirements: [STUD-01, STUD-02, STUD-05]

must_haves:
  truths:
    - "6 ontology types are listed and selectable in the left panel"
    - "Selecting a type shows Predicates, Relations, and Statistics in the detail panel"
    - "Type edit dialog opens and allows modifying type properties"
    - "Edge filter dropdown (All/Outbound/Inbound) is present and changes state"
    - "Global role state is available via React Context for cross-page sharing"
  artifacts:
    - path: "src/contexts/RoleContext.tsx"
      provides: "Global role state provider with useRole hook"
      exports: ["RoleProvider", "useRole"]
    - path: "src/components/studio/TypeList.tsx"
      provides: "6 ontology type cards with selection"
      min_lines: 40
    - path: "src/components/studio/TypeDetail.tsx"
      provides: "Predicates/Relations/Statistics detail panel"
      min_lines: 60
    - path: "src/components/studio/TypeEditDialog.tsx"
      provides: "Type edit dialog with shadcn Dialog"
      min_lines: 40
    - path: "src/components/studio/StudioPage.tsx"
      provides: "2-panel layout orchestrator (35:65 ratio)"
      min_lines: 50
    - path: "src/app/workspace/studio/page.tsx"
      provides: "Next.js route for /workspace/studio"
  key_links:
    - from: "src/components/studio/StudioPage.tsx"
      to: "src/components/studio/TypeList.tsx"
      via: "import and render with selectedType state"
      pattern: "selectedType.*setSelectedType"
    - from: "src/components/studio/TypeDetail.tsx"
      to: "src/data/studio-data.ts"
      via: "receives OntologyType from parent"
      pattern: "predicates|relations|nodeCount"
    - from: "src/contexts/RoleContext.tsx"
      to: "src/app/layout.tsx"
      via: "RoleProvider wraps app (added in Plan 03 integration)"
      pattern: "RoleProvider"
---

<objective>
Build the Ontology Studio page shell with left panel components (TypeList, TypeDetail, TypeEditDialog) and the global RoleContext provider.

Purpose: Establishes the 2-panel Studio layout, type selection/detail flow, and edit dialog. Right panel graph/chart areas are placeholder divs that Plan 02 and Plan 03 will fill. RoleContext is created here so both Studio and User Management pages can share role state with the Query Console later.

Output: 6 files -- RoleContext provider, 3 studio components, StudioPage orchestrator, route page.
</objective>

<execution_context>
@/Users/chs/.claude/get-shit-done/workflows/execute-plan.md
@/Users/chs/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-ontology-studio-user-mgmt/06-CONTEXT.md
@.planning/phases/06-ontology-studio-user-mgmt/06-RESEARCH.md

@src/types/index.ts
@src/data/studio-data.ts
@src/components/charts/shared/chart-utils.ts
@src/app/layout.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: RoleContext global provider</name>
  <files>src/contexts/RoleContext.tsx</files>
  <action>
Create `src/contexts/RoleContext.tsx` with:

1. A React Context holding `{ currentRole: Role; setCurrentRole: (role: Role) => void }`.
2. `RoleProvider` component that wraps children with the context, using `useState<Role>("super_admin")` as default (per research recommendation: demo starts with full access).
3. `useRole()` hook that reads context and throws if used outside provider.

Import `Role` from `@/types`. Use `"use client"` directive. Export `RoleProvider` and `useRole`.

Do NOT wrap the app root layout with RoleProvider yet -- that will happen in Plan 03 Task 3 when the full integration is done. Just create and export the provider.
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit src/contexts/RoleContext.tsx` (or run `npm run build` at end of plan)</verify>
  <done>RoleContext.tsx exports RoleProvider and useRole hook, defaults to "super_admin"</done>
</task>

<task type="auto">
  <name>Task 2: Studio left panel components (TypeList, TypeDetail, TypeEditDialog)</name>
  <files>
    src/components/studio/TypeList.tsx
    src/components/studio/TypeDetail.tsx
    src/components/studio/TypeEditDialog.tsx
  </files>
  <action>
**TypeList.tsx** (`"use client"`):
- Props: `{ types: OntologyType[]; selectedType: OntologyType | null; onSelect: (type: OntologyType) => void }`.
- Renders a scrollable vertical list of 6 type cards using shadcn Card. Each card shows:
  - Type name (bold), icon from lucide-react (use Box for Equipment, Workflow for Process, Circle for Wafer, FileText for Recipe, AlertTriangle for Defect, Wrench for MaintenanceRecord -- or similar appropriate icons).
  - Description (muted text, truncated to 1 line).
  - Badge showing nodeCount formatted with `formatNumber` from chart-utils (e.g., "832" or "156K").
- Selected card gets highlighted border/background using `data-[selected=true]` or conditional classes.
- Add `data-testid="type-list"` on container, `data-testid="type-item-{name}"` on each card.

**TypeDetail.tsx** (`"use client"`):
- Props: `{ type: OntologyType | null; edgeFilter: EdgeFilter; onEdgeFilterChange: (filter: EdgeFilter) => void; onEdit: () => void }`.
- Type alias `EdgeFilter = "all" | "outbound" | "inbound"` (export it).
- If `type` is null, show empty state message "Select a type to view details".
- Uses shadcn Tabs with 3 tabs: Predicates, Relations, Statistics.
  - **Predicates tab:** List each predicate as a badge or chip (e.g., `equipment_id`, `name`, `type`...).
  - **Relations tab:** List each relation showing `name -> target` with direction arrow icon. Include the Edge Filter dropdown (shadcn Select) with options All/Outbound/Inbound. Filter is relative to the selected type: Outbound = relations where this type is source, Inbound = relations from other types pointing to this type (derive inbound relations by scanning all types).
  - **Statistics tab:** Show nodeCount with large number, and relation count.
- "Edit Type" button (top right of panel or inside Statistics tab) that calls `onEdit()`.
- Add `data-testid="type-detail"`.

**TypeEditDialog.tsx** (`"use client"`):
- Props: `{ type: OntologyType | null; open: boolean; onOpenChange: (open: boolean) => void }`.
- Uses shadcn Dialog. Shows a form with:
  - Type name (read-only input, disabled).
  - Description (editable textarea).
  - Predicates list with the ability to add/remove predicates (simple input + button to add, X to remove). This is client-state only editing -- no DB persist per user decision.
- "Save" button closes dialog. Since this is POC, save just closes -- no actual persistence.
- Add `data-testid="type-edit-dialog"`.
  </action>
  <verify>All three files compile without errors. Verify imports resolve: `OntologyType` from `@/types`, shadcn components from `@/components/ui/*`.</verify>
  <done>TypeList renders 6 cards with selection, TypeDetail shows 3-tab panel with edge filter, TypeEditDialog opens/closes with form</done>
</task>

<task type="auto">
  <name>Task 3: StudioPage layout + route</name>
  <files>
    src/components/studio/StudioPage.tsx
    src/app/workspace/studio/page.tsx
  </files>
  <action>
**StudioPage.tsx** (`"use client"`):
- Main state: `selectedType: OntologyType | null` (default: first type), `edgeFilter: EdgeFilter` (default: "all"), `editDialogOpen: boolean`.
- Calls `getOntologyTypes()` from `@/data/studio-data` on mount to get the 6 types.
- 2-panel layout using CSS grid or flex:
  - Left panel (~35% width): TypeList (top) + TypeDetail (bottom), separated by a visual divider. Both panels scroll independently.
  - Right panel (~65% width): Two placeholder divs with min-height for OntologyGraph (top, taller ~60% of right panel) and TypeDistributionChart (bottom, ~40% of right panel). Each placeholder shows a Card with centered text "OntologyGraph" / "TypeDistributionChart" and a dashed border to indicate pending integration. These placeholders will be replaced by real components in Plan 03.
- Pass `selectedType`, `edgeFilter`, and callbacks down to children.
- Pass `edgeFilter` and `selectedType` down to the graph placeholder (will be needed for OntologyGraph props).
- Wrap the layout with appropriate padding/gap consistent with the app shell pattern.
- Add `data-testid="studio-page"`.

**page.tsx** (server component, minimal):
```tsx
import { StudioPage } from "@/components/studio/StudioPage";

export default function StudioRoute() {
  return <StudioPage />;
}
```

Ensure the `src/app/workspace/studio/` directory is created. This route will be accessible at `/workspace/studio`.
  </action>
  <verify>Run `npm run build` -- the studio page should compile. Visit `/workspace/studio` in dev mode to confirm 2-panel layout renders with left panel components and right panel placeholders.</verify>
  <done>2-panel Studio page renders at /workspace/studio with TypeList (6 types), TypeDetail (3 tabs), TypeEditDialog, and right-panel placeholders at approximately 35:65 ratio</done>
</task>

</tasks>

<verification>
- `npm run build` passes without errors
- `/workspace/studio` route exists and renders
- TypeList shows 6 ontology types with selection highlighting
- TypeDetail shows Predicates/Relations/Statistics tabs for selected type
- Edge filter dropdown present with All/Outbound/Inbound options
- TypeEditDialog opens on Edit button click
- Right panel shows placeholder areas for graph and distribution chart
</verification>

<success_criteria>
- 6 ontology types selectable in left panel with detail panel updating on selection
- 3-tab detail panel (Predicates, Relations, Statistics) populated from studio-data.ts
- Edge filter dropdown changes edgeFilter state
- Type edit dialog opens with form fields
- 2-panel layout at ~35:65 ratio with right-panel placeholders
- RoleContext provider exported and ready for app-level integration
</success_criteria>

<output>
After completion, create `.planning/phases/06-ontology-studio-user-mgmt/06-01-SUMMARY.md`
</output>
